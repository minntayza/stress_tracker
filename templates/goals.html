<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Goals - Stress Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-bar">
        <div class="nav-inner">
            <div class="brand">Stress Tracker</div>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/history">History</a>
                <a href="/goals" class="active">Goals</a>
                <span class="nav-user">{{ user.username }}</span>
                <a href="/logout" class="nav-logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container animate__animated animate__fadeIn">
        <div class="page-header">
            <h1>My Goals</h1>
            <button onclick="document.getElementById('createGoalModal').style.display='block'"
                class="btn btn-primary-prominent">
                New Goal
            </button>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% if goals %}
        <div style="display: grid; gap: 1.5rem;">
            {% for goal in goals %}
            <div class="result-card" style="position: relative; border-left: 4px solid 
                        {% if goal.status == 'completed' %}var(--secondary-color)
                        {% elif goal.status == 'expired' %}#636e72
                        {% else %}var(--primary-color){% endif %};">

                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <div>
                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">
                            {{ goal.description or 'Goal #' + goal.id|string }}
                        </div>
                        <div style="color: #636e72; font-size: 0.9rem;">
                            {% if goal.goal_type == 'avg_stress' %}Average Stress
                            {% elif goal.goal_type == 'peak_stress' %}Peak Stress Reduction
                            {% elif goal.goal_type == 'streak_days' %}Consistent Days
                            {% endif %}
                            {% if goal.deadline %}¬∑ Deadline: {{ goal.deadline.strftime('%b %d, %Y') }}{% endif %}
                        </div>
                    </div>

                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        {% if goal.status == 'completed' %}
                        <span
                            style="background: var(--secondary-color); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">‚úì
                            Completed</span>
                        {% elif goal.status == 'expired' %}
                        <span
                            style="background: #636e72; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem;">Expired</span>
                        {% else %}
                        <span
                            style="background: var(--primary-color); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Active</span>
                        {% endif %}

                        <form method="POST" action="/goals/{{ goal.id }}/delete" style="margin: 0;"
                            onsubmit="return confirm('Are you sure you want to delete this goal?');">
                            <button type="submit"
                                style="background: none; border: none; color: #d63031; cursor: pointer; padding: 0.5rem; font-size: 1.2rem;"
                                title="Delete goal">üóëÔ∏è</button>
                        </form>
                    </div>
                </div>

                <div style="margin-top: 1.5rem;">
                    <div
                        style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 0.5rem;">
                        <span>Progress</span>
                        <span style="font-weight: 600; color: var(--primary-color);">{{
                            goal.calculate_progress()|round(1) }}%</span>
                    </div>

                    <div style="width: 100%; background: #dfe6e9; height: 12px; border-radius: 6px; overflow: hidden;">
                        <div
                            style="height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); width: {{ goal.calculate_progress() }}%; transition: width 0.8s ease;">
                        </div>
                    </div>

                    <div
                        style="display: flex; justify-content: space-between; margin-top: 0.75rem; font-size: 0.9rem; color: #636e72;">
                        <span>Current: <strong>{{ goal.current_value|round(1) }}</strong></span>
                        <span>Target: <strong>{{ goal.target_value|round(1) }}</strong></span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="result-card" style="text-align: center; padding: 3rem;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üéØ</div>
            <h3>No goals yet!</h3>
            <p style="color: #636e72; margin: 1rem 0;">Set a stress reduction goal to start tracking your progress.</p>
            <button onclick="document.getElementById('createGoalModal').style.display='block'"
                class="btn btn-primary-prominent" style="margin-top: 1rem;">
                Create Your First Goal
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Create Goal Modal -->
    <div id="createGoalModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow: auto;">
        <div
            style="max-width: 500px; margin: 5% auto; background: white; border-radius: 16px; padding: 2rem; position: relative;">
            <button onclick="document.getElementById('createGoalModal').style.display='none'"
                style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #636e72;">√ó</button>

            <h2 style="margin-bottom: 1.5rem;">Create New Goal</h2>

            <form method="POST" action="/goals/create">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Goal Type</label>
                    <select name="goal_type" required
                        style="width: 100%; padding: 0.75rem; border: 2px solid #dfe6e9; border-radius: 8px; font-size: 1rem;">
                        <option value="avg_stress">Reduce Average Stress</option>
                        <option value="peak_stress">Lower Peak Stress</option>
                    </select>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Description</label>
                    <input type="text" name="description" placeholder="E.g., Get my stress below 40"
                        style="width: 100%; padding: 0.75rem; border: 2px solid #dfe6e9; border-radius: 8px; font-size: 1rem;">
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Target Value (0-100)</label>
                    <input type="number" name="target_value" min="0" max="100" step="0.1" required placeholder="40"
                        style="width: 100%; padding: 0.75rem; border: 2px solid #dfe6e9; border-radius: 8px; font-size: 1rem;">
                    <small style="color: #636e72; margin-top: 0.25rem; display: block;">Lower stress values are
                        better</small>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Deadline (Optional)</label>
                    <input type="date" name="deadline"
                        style="width: 100%; padding: 0.75rem; border: 2px solid #dfe6e9; border-radius: 8px; font-size: 1rem;">
                </div>

                <button type="submit" class="btn btn-primary-prominent" style="width: 100%; margin: 0;">
                    Create Goal
                </button>
            </form>
        </div>
    </div>
</body>

</html>
